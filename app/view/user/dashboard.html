<!DOCTYPE html>
<html lang="en">
<head>
	<include href="blocks/head.html" />
	<check if="{{ @user.api_key }}">
		<link rel="alternate" type="application/atom+xml" title="{{ @dict.assigned_issues }}" href="{{ @site.url }}atom.xml?type=assigned&amp;user={{ @user.username }}&amp;key={{ @user.api_key }}" />
		<link rel="alternate" type="application/atom+xml" title="{{ @dict.created_issues }}" href="{{ @site.url }}atom.xml?type=created&amp;user={{ @user.username }}&amp;key={{ @user.api_key }}" />
		<link rel="alternate" type="application/atom+xml" title="All Issues" href="{{ @site.url }}atom.xml?type=all&amp;key={{ @user.api_key }}" />
	</check>
</head>
<body class="dashboard">
<set fullwidth="{{ true }}" />
<include href="blocks/navbar.html" />
<div class="container-fluid">
	<include href="blocks/navbar.html" />

	<div class="row">

		<div class="col-sm-9">
			<check if="{{ empty(@groups) }}">
				<true>
					<include href="blocks/issue-list.html" />
				</true>
				<false>
					<repeat group="{{ @groups }}" key="{{ @key }}" value="{{ @group }}">
						<h3>{{ @group.title }}</h3>
						<set issues="{{ @group.issues }}" />
						<include href="blocks/issue-list.html" />
					</repeat>
				</false>
			</check>
		</div>

		<div class="col-sm-3">
			<div class="dashboard-options">
				<div class="panel panel-default">
					<div class="panel-heading">Filters</div>
					<div class="panel-body">
						<ul class="nav nav-pills">
							<li {{ @options.filter_groups == 1 ? 'class="active"':'' }}><a href="?filter_groups=1">Include Groups</a></li>
							<li {{ @options.filter_groups == 0 ? 'class="active"':'' }}><a href="?filter_groups=0">Just Me</a></li>
						</ul>
						<br>
						<ul class="nav nav-pills">
							<li {{ @options.filter_user == 'assigned' ? 'class="active"':'' }}><a href="?filter_user=assigned">Assigned</a></li>
							<li {{ @options.filter_user == 'created' ? 'class="active"':'' }}><a href="?filter_user=created">Created</a></li>
							<li {{ @options.filter_user == 'both' ? 'class="active"':'' }}><a href="?filter_user=both">Both</a></li>
						</ul>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">Grouping</div>
					<div class="panel-body">
						<ul class="nav nav-pills">
							<li {{ @options.group == 'project' ? 'class="active"':'' }}><a href="?group=project">Project</a></li>
							<li {{ @options.group == 'sprint' ? 'class="active"':'' }}><a href="?group=sprint">Sprint</a></li>
							<li {{ @options.group == 'group' ? 'class="active"':'' }}><a href="?group=group">Created By Group</a></li>
							<li {{ @options.group == '' ? 'class="active"':'' }}><a href="?group=">None</a></li>
						</ul>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">Sorting</div>
					<div class="panel-body">
						<ul class="nav nav-pills">
							<li {{ @options.sort == 'due_date' ? 'class="active"':'' }}><a href="?sort=due_date">Due Date</a></li>
							<li {{ @options.sort == 'priority' ? 'class="active"':'' }}><a href="?sort=priority">Priority</a></li>
							<li {{ @options.sort == 'created' ? 'class="active"':'' }}><a href="?sort=created">Created</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>

	</div>

	<exclude>
	<div class="row">
		<div class="col-sm-5">
			<h3>{{ @dict.my_projects }}&ensp;<small>{{ count(@projects) }}</small>&ensp;
				<a class="btn btn-sm btn-default has-tooltip" href="issues/new/{{ @issue_type.project }}" title="{{ @dict.add_project }}"><span class="glyphicon glyphicon-plus"></span></a>
			</h3>
			<set issues="{{ @projects }}" />
			<include href="blocks/dashboard-issue-list.html" />

			<check if="{{ count(@bugs) }}">
				<h3>{{ @dict.my_bugs }}&ensp;<small>{{ count(@bugs) }}</small>&ensp;
					<a class="btn btn-sm btn-default has-tooltip" href="issues/new/{{ @issue_type.bug }}" title="{{ @dict.add_bug }}"><span class="glyphicon glyphicon-plus"></span></a>
				</h3>
				<set issues="{{ @bugs }}" />
				<include href="blocks/dashboard-issue-list.html" />
			</include>

			<check if="{{ count(@repeat_issues) }}">
				<h3>{{ @dict.repeat_work }}&ensp;<small>{{ count(@repeat_issues) }}</small>&ensp;</h3>
				<set issues="{{ @repeat_issues }}" />
				<include href="blocks/dashboard-issue-list.html" />
			</check>

			<check if="{{ count(@watchlist) }}">
				<h3>{{ @dict.my_watchlist }}&ensp;<small>{{ count(@watchlist) }}</small>&ensp;</h3>
				<set issues="{{ @watchlist }}" />
				<include href="blocks/dashboard-issue-list.html" />
			</check>
		</div>
		<div class="col-sm-7">
			<div class="clearfix">
				<h3 class="pull-left">{{ @dict.my_tasks }}&ensp;<small>{{ count(@tasks) }}</small>&ensp;
					<a class="btn btn-sm btn-default has-tooltip" href="issues/new/{{ @issue_type.task }}" title="{{ @dict.add_task }}"><span class="glyphicon glyphicon-plus"></span></a>
				</h3>
				<check if="{{ @sprint && @sprint.id }}">
					<div class="h3 pull-right text-right">
						<a class="btn btn-default btn-sm" href="taskboard/{{ @sprint.id }}/me"><span class="glyphicon glyphicon-list"></span>&ensp;{{ @dict.taskboard }}</a>
					</div>
				</check>
			</div>
			<set issues="{{ @tasks }}" />
			<include href="blocks/dashboard-issue-list.html" />
		</div>
	</div>
	</exclude>
	<include href="blocks/footer.html" />
</div>
<script type="text/javascript">
$(window).resize(function() {
	var $options = $('.dashboard-options');
	if($(window).height() > $options.height() + 100) {
		var width = $(window).width(),
			offset = $options.offset(),
			parent = $options.parent();
		$options.css({
			position: 'fixed',
			width: parent.width(),
			top: offset.top,
			right: parent.css('padding-right')
		});
	} else {
		$options.css({
			position: 'static',
			width: 'auto'
		});
	}
});
$(document).ready(function() {
	$(window).resize();
});
</script>
</body>
</html>
